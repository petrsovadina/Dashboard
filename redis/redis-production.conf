# Redis Production Configuration
# Optimized for Azure AI Dashboard

# NETWORK & SECURITY
bind 127.0.0.1
port 0
unixsocket /var/run/redis/redis.sock
unixsocketperm 770

# AUTHENTICATION & AUTHORIZATION
# Password will be set via environment variable
# requirepass will be set in docker-compose

# MEMORY MANAGEMENT
maxmemory 512mb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# PERSISTENCE
save 900 1     # Save if at least 1 key changed in 900 seconds
save 300 10    # Save if at least 10 keys changed in 300 seconds  
save 60 10000  # Save if at least 10000 keys changed in 60 seconds

# AOF Configuration
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# GENERAL SETTINGS
timeout 0
tcp-keepalive 300
tcp-backlog 511

# LOGGING
loglevel notice
logfile ""
syslog-enabled no

# PERFORMANCE TUNING
databases 1  # Single database for simplicity
hz 10       # Background task frequency

# SLOW LOG
slowlog-log-slower-than 10000
slowlog-max-len 128

# LATENCY MONITORING
latency-monitor-threshold 100

# CLIENT SETTINGS
maxclients 10000

# SECURITY HARDENING
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG "CONFIG_b835r2t4y7u8i9o0p"
rename-command SHUTDOWN "SHUTDOWN_a1b2c3d4e5f6g7h8"

# TLS Configuration (if enabled)
tls-port 6380
tls-cert-file /tls/redis.crt
tls-key-file /tls/redis.key
tls-ca-cert-file /tls/ca.crt
tls-protocols "TLSv1.2 TLSv1.3"